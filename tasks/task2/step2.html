<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Step 2: Writing Test Script &mdash; LTRATO-2001  documentation</title><link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/copybutton.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  <script id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/language_data.js"></script>
        <script src="../../_static/clipboard.min.js"></script>
        <script src="../../_static/copybutton.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Task 3: Verification" href="../task3/index.html" />
    <link rel="prev" title="Step 1: Collect Show Commands" href="step1.html" /> <link href="../../_static/style.css" rel="stylesheet" type="text/css"> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../index.html" class="icon icon-home"> LTRATO-2001<img src="../../_static/CL-2022.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption"><span class="caption-text">Table of Contents</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../introduction/index.html">Introduction</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../introduction/index.html#prerequisites">Prerequisites</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../introduction/index.html#learning-objectives">Learning Objectives</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../labaccess/index.html">Lab Access</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../labaccess/index.html#ip-addressing-and-access-information">IP Addressing and Access Information</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../labaccess/index.html#component-details">Component Details</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../labaccess/index.html#get-started">Get Started</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Tasks</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../task1/index.html">Task 1: Exploring and Verification</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../task1/step1.html">Step 1: Explore Lab Structure</a></li>
<li class="toctree-l3"><a class="reference internal" href="../task1/step2.html">Step 2: Verify pyATS Testbed File</a></li>
<li class="toctree-l3"><a class="reference internal" href="../task1/step3.html">Step 3: pyATS Capabilities using the pyATS Shell</a></li>
<li class="toctree-l3"><a class="reference internal" href="../task1/step4.html">Step 4: pyATS Shell Useful Libraries</a></li>
</ul>
</li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html">Task 2: Writing Initial Scripts</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="step1.html">Step 1: Collect Show Commands</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Step 2: Writing Test Script</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../task3/index.html">Task 3: Verification</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../task3/step1.html">Step 1: Verify Log Messages</a></li>
<li class="toctree-l3"><a class="reference internal" href="../task3/step2.html">Step 2: Verify the Service Contracts Coverage</a></li>
<li class="toctree-l3"><a class="reference internal" href="../task3/step3.html">Step 3: Verify the Routing Information using Parsers and pyATS Learn</a></li>
<li class="toctree-l3"><a class="reference internal" href="../task3/step4.html">Step 4: Run PING to Verify Reachability</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../task4/index.html">Task 4: Results</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../task4/step1.html">Step 1: Show the Results of Tests in a Browser</a></li>
<li class="toctree-l3"><a class="reference internal" href="../task4/step2.html">Step 2: Run tests and compare results from XPRESSO dashboard</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../conclusions.html">Conclusions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../appendix.html">Appendix: A</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../appendix.html#links">Links</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../appendix.html#examples">Examples</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../appendix.html#configuration-compliance">Configuration Compliance</a></li>
</ul>
</li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">LTRATO-2001</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content style-external-links">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">Tasks</a></li>
          <li class="breadcrumb-item"><a href="index.html">Task 2: Writing Initial Scripts</a></li>
      <li class="breadcrumb-item active">Step 2: Writing Test Script</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/tasks/task2/step2.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="section" id="step-2-writing-test-script">
<h1>Step 2: Writing Test Script<a class="headerlink" href="#step-2-writing-test-script" title="Permalink to this headline">¶</a></h1>
<p><strong>Value Proposition:</strong> We will write our first test script on Python using the pyATS library.
Our test script will connect to all the devices in the testbed and print the results of the connection.
If the connections to all the devices are successful, the test will pass; otherwise, it will fail.
Using this simple test script, we will learn the structure of the pyATS test script file.</p>
<p>The pyATS test script is a file in Python code that uses the pyATS library.
The structure of the pyATS test script is modular and straightforward.
Each test script is written in a Python file and split into three major sections (Python classes) – see the illustration below for a graphical representation:</p>
<ul class="simple">
<li><p><strong>Common Setup:</strong> is where all the common configurations, prerequisites, and initializations shared between the script’s test cases should be performed.</p></li>
<li><p><strong>Testcase(s):</strong> is a container/collection of smaller tests. Testcases are the workhorse of every test script, carrying out the assessments that determine the quality of the product under scrutiny. Each test case may have its Setup Section and Cleanup Section, and an arbitrary number of smaller Test Sections.</p></li>
<li><p><strong>Common Cleanup:</strong> is the last section to run within each test script. Any configurations, initializations, and environmental changes that occurred during this script run should be cleaned up (removed) here.</p></li>
</ul>
<p>Each of these sections is further broken down into smaller subsections (Python methods of the class).</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>There can be only one Common Setup and only one Common in a script, whereas there might be multiple test cases in one test script.</p>
</div>
<a class="reference internal image-reference" href="../../_images/test-script-structure.png"><img alt="../../_images/test-script-structure.png" class="align-center" src="../../_images/test-script-structure.png" style="width: 75%;" /></a>
<ol class="arabic">
<li><p>Let’s verify our first test script. Open the file <strong>task2step2.py</strong> and observe its structure:</p>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>nano task2step2.py
</pre></div>
</div>
</div></blockquote>
</li>
<li><p>Pay special attention to the following part of the code. Whereas it’s not only related to this task, it will help you understand the logging capabilities of pyATS that will be used in other tasks during this lab:</p>
<blockquote>
<div><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># To get a logger for the script</span>
<span class="kn">import</span> <span class="nn">logging</span>

<span class="c1"># Get your logger for your script</span>
<span class="n">LOGGER</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
<span class="n">LOGGER</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
</li>
<li><p>When the pyATS banner is used, the following message will be displayed in the test output.</p>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>Connecting to device <span class="s1">&#39;csr1000v-1&#39;</span>...
</pre></div>
</div>
<a class="reference internal image-reference" href="../../_images/pyats-logger-banner.png"><img alt="../../_images/pyats-logger-banner.png" class="align-center" src="../../_images/pyats-logger-banner.png" style="width: 75%;" /></a>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The pyATS logging banner itself does not perform logging; it only formats input messages.
Hence, the <strong>log.info(banner(“logging message”))</strong> construction is used in the code for logging.
Since the banner is logged with INFO logging level, it’s required to set the logging level up to INFO (default is WARNING):
<strong>log.setLevel(logging.INFO)</strong></p>
</div>
</div></blockquote>
</li>
<li><p>Let’s look at the main contents of this example. Python class <strong>common_setup</strong>, which inherits from <strong>aetest.CommonSetup</strong> represents the major section, “Common Setup” (see the following illustration).  The Python class <strong>common_setup</strong> is where initializations happen. This initialization is required before executing any tests. For this reason, the code in class <strong>common_setup</strong> is always executed first. The following snippet of code is taken from the task2step2.py file:</p>
<blockquote>
<div><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">common_setup</span><span class="p">(</span><span class="n">aetest</span><span class="o">.</span><span class="n">CommonSetup</span><span class="p">):</span>
<span class="sd">&quot;&quot;&quot;Common Setup section&quot;&quot;&quot;</span>

<span class="nd">@aetest</span><span class="o">.</span><span class="n">subsection</span>
<span class="k">def</span> <span class="nf">establish_connections</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pyats_testbed</span><span class="p">):</span>
    <span class="n">device_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="c1"># Load all devices from testbed file and try to connect to them</span>
    <span class="k">for</span> <span class="n">device</span> <span class="ow">in</span> <span class="n">pyats_testbed</span><span class="o">.</span><span class="n">devices</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
        <span class="n">LOGGER</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">banner</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Connecting to device &#39;</span><span class="si">{device.name}</span><span class="s2">&#39;...&quot;</span><span class="p">))</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">device</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">log_stdout</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">errors</span><span class="o">.</span><span class="n">ConnectionError</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">failed</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to establish a connection to &#39;</span><span class="si">{device.name}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
        <span class="n">device_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
    <span class="c1"># Pass list of devices to testcases</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">dev</span><span class="o">=</span><span class="n">device_list</span><span class="p">)</span>
</pre></div>
</div>
<p>The following code is used to load a testbed file from the filename specified in the command-line option (<strong>–testbed</strong> is a command line key, <strong>dest</strong> – specifies the name of the object that would represent the testbed file in code):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">()</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;--testbed&quot;</span><span class="p">,</span>
        <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;pyats_testbed&quot;</span><span class="p">,</span>
        <span class="nb">type</span><span class="o">=</span><span class="n">loader</span><span class="o">.</span><span class="n">load</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="s2">&quot;pyats_testbed.yaml&quot;</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">args</span><span class="p">,</span> <span class="n">unknown</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_known_args</span><span class="p">()</span>

    <span class="n">aetest</span><span class="o">.</span><span class="n">main</span><span class="p">(</span><span class="o">**</span><span class="nb">vars</span><span class="p">(</span><span class="n">args</span><span class="p">))</span>
</pre></div>
</div>
</div></blockquote>
</li>
<li><p>Exit Nano without saving by pressing <span class="guilabel">Ctrl + X</span></p></li>
<li><p>Let’s run our first test script. This test script will try to connect to all the devices in the testbed and print the results of these attempts:</p>
<blockquote>
<div><div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python task2step2.py --testbed pyats_testbed.yaml
</pre></div>
</div>
</div></blockquote>
</li>
<li><p>Upon finishing the test script, pyATS generates a report of Success/Failed testcases. The <strong>common_setup</strong> section is also treated as the testcase with subsection <strong>establish_connections</strong>. Since all the devices are reachable, the testcases should be successful (PASSED). Refer to the following diagram.</p>
<blockquote>
<div><a class="reference internal image-reference" href="../../_images/step7-output.png"><img alt="../../_images/step7-output.png" class="align-center" src="../../_images/step7-output.png" style="width: 75%;" /></a>
</div></blockquote>
</li>
</ol>
<p><em>Section author: Luis Rueda &lt;<a class="reference external" href="mailto:lurueda&#37;&#52;&#48;cisco&#46;com">lurueda<span>&#64;</span>cisco<span>&#46;</span>com</a>&gt;, Jairo Leon &lt;<a class="reference external" href="mailto:jaileon&#37;&#52;&#48;cisco&#46;com">jaileon<span>&#64;</span>cisco<span>&#46;</span>com</a>&gt;</em></p>
</div>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="step1.html" class="btn btn-neutral float-left" title="Step 1: Collect Show Commands" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../task3/index.html" class="btn btn-neutral float-right" title="Task 3: Verification" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright Cisco Systems, Inc. 2020.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>